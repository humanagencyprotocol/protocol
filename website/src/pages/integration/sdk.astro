---
import { getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const entry = await getEntry('docs', 'sdk');
const { Content } = await entry.render();
---

<BaseLayout title={`${entry.data.title} | Human Agency Protocol`}>
    <article class="content">
        {(entry.data.version || entry.data.date) && (
            <div class="version-badge-top">
                {entry.data.version && <span class="version-pill">{entry.data.version}</span>}
                {entry.data.date && <span class="version-date">{entry.data.date}</span>}
            </div>
        )}
        <h1>{entry.data.title}</h1>

        <!-- Copy SDK Docs Button -->
        <div class="sdk-copy-section">
            <button id="copy-sdk-docs" class="btn btn-secondary">
                Ask your AI about this SDK
            </button>
            <p class="copy-hint">Copies complete SDK documentation (README + API + Local Development Guide)</p>
        </div>

        <Content />

        <div class="next-page">
            <a href="/integration" class="btn btn-outline">← Back: Integration</a>
            <a href="/service" class="btn btn-primary">Next: Service Providers →</a>
        </div>
    </article>
</BaseLayout>

<style>
    .version-badge-top {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.85rem;
        margin-bottom: 1.5rem;
    }

    .version-pill {
        display: inline-block;
        color: var(--text-tertiary);
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        padding: 0.35rem 0.85rem;
        border-radius: 2rem;
        font-weight: 500;
    }

    .version-date {
        color: var(--text-tertiary);
        font-weight: 400;
    }

    .sdk-copy-section {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2rem;
        margin: 2rem 0 3rem;
        text-align: center;
    }

    .sdk-copy-section .btn {
        margin-bottom: 0.75rem;
    }

    .copy-hint {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin: 0;
    }

    .next-page {
        display: flex;
        gap: 1rem;
        justify-content: space-between;
        margin-top: 4rem;
        padding-top: 3rem;
        border-top: 1px solid var(--border);
    }

    @media (max-width: 640px) {
        .next-page {
            flex-direction: column;
        }
    }
</style>

<script>
    document.getElementById('copy-sdk-docs')?.addEventListener('click', async () => {
        const button = document.getElementById('copy-sdk-docs');
        const originalText = button?.textContent;

        try {
            button.textContent = 'Copying SDK documentation...';

            // Fetch the SDK context
            const response = await fetch('/sdk-context.txt');
            const text = await response.text();

            // Try modern clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                try {
                    await navigator.clipboard.writeText(text);
                } catch (clipboardErr) {
                    // Fallback for iOS and other browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = '0';
                    document.body.appendChild(textarea);
                    textarea.focus();
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                }
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }

            // Success feedback
            button.textContent = 'Copied! Paste it in your AI Chat';
            setTimeout(() => {
                if (button) button.textContent = originalText;
            }, 3000);

        } catch (error) {
            console.error('Failed to copy:', error);
            button.textContent = 'Copy failed. Please try again.';
            setTimeout(() => {
                if (button) button.textContent = originalText;
            }, 3000);
        }
    });
</script>
