---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="HAP - The Human Direction Protocol">
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
        <h1>Execution is cheap. <br><span class="highlight">Direction is scarce.</span></h1>
        <h2 class="hero-subtitle">HAP is the protocol for human-authored direction. It ensures AI never executes without a Decision Owner.</h2>

        <div class="hero-body">
            <p>AI optimizes execution at machine speed, but it cannot author direction.<br>It scales the <strong>how</strong>, but only humans can decide the <strong>why</strong>.</p>
            <p class="key-statement"><strong><span class="highlight">Direction is the last human domain. HAP protects it.</span></strong></p>
        </div>

        <div class="cta-group">
            <button id="ask-ai-btn" class="btn btn-primary">Ask your AI about HAP</button>
            <a href="#why-exists" class="btn btn-secondary">Read more</a>
        </div>

        <!-- Discovery Engine -->
        <div id="persona-section" class="persona-section" style="display: none;">
            <!-- Step 1: Domain -->
            <p class="persona-intro">Create a prompt to learn more how you can use HAP for:</p>
            <div class="selection-grid domain-grid">
                <button class="selection-btn" data-domain="organizations">
                    <span class="selection-title">Organizations</span>
                </button>
                <button class="selection-btn" data-domain="cities">
                    <span class="selection-title">Cities</span>
                </button>
                <button class="selection-btn" data-domain="startups">
                    <span class="selection-title">Startups</span>
                </button>
            </div>

            <!-- Step 2: Lens (Hidden until domain selected) -->
            <div id="lens-selection" style="display: none; margin-top: 2rem;">
                <p class="persona-intro" id="lens-intro">Analyze this as...</p>
                <div class="selection-grid lens-grid" id="lens-options">
                    <!-- Default lenses for Organizations -->
                    <button class="selection-btn" data-lens="ceo" data-domains="organizations">
                        <span class="selection-title">CEO</span>
                    </button>
                    <button class="selection-btn" data-lens="cto" data-domains="organizations">
                        <span class="selection-title">CTO</span>
                    </button>
                    <button class="selection-btn" data-lens="legal" data-domains="organizations">
                        <span class="selection-title">Legal</span>
                    </button>
                    <button class="selection-btn" data-lens="hr" data-domains="organizations">
                        <span class="selection-title">HR</span>
                    </button>
                    <button class="selection-btn" data-lens="consultants" data-domains="organizations">
                        <span class="selection-title">Consultants</span>
                    </button>
                    <!-- Lenses for Cities -->
                    <button class="selection-btn" data-lens="mayor" data-domains="cities" style="display:none;">
                        <span class="selection-title">Mayor</span>
                    </button>
                    <button class="selection-btn" data-lens="city-planner" data-domains="cities" style="display:none;">
                        <span class="selection-title">City Planner</span>
                    </button>
                    <button class="selection-btn" data-lens="public-safety" data-domains="cities" style="display:none;">
                        <span class="selection-title">Public Safety</span>
                    </button>
                    <button class="selection-btn" data-lens="infrastructure" data-domains="cities" style="display:none;">
                        <span class="selection-title">Infrastructure</span>
                    </button>
                    <button class="selection-btn" data-lens="citizen-services" data-domains="cities" style="display:none;">
                        <span class="selection-title">Citizen Services</span>
                    </button>
                    <!-- Lenses for Startups -->
                    <button class="selection-btn" data-lens="healthcare" data-domains="startups" style="display:none;">
                        <span class="selection-title">Healthcare</span>
                    </button>
                    <button class="selection-btn" data-lens="finance" data-domains="startups" style="display:none;">
                        <span class="selection-title">Finance</span>
                    </button>
                    <button class="selection-btn" data-lens="education" data-domains="startups" style="display:none;">
                        <span class="selection-title">Education</span>
                    </button>
                    <button class="selection-btn" data-lens="relationships" data-domains="startups" style="display:none;">
                        <span class="selection-title">Relationships</span>
                    </button>
                    <button class="selection-btn" data-lens="personal-development" data-domains="startups" style="display:none;">
                        <span class="selection-title">Personal Development</span>
                    </button>
                </div>
            </div>

            <!-- Expanded Prompt Display -->
            <div id="prompt-display" class="prompt-display" style="display: none;">
                <div class="prompt-content">
                    <h4 id="prompt-title" class="prompt-title"></h4>
                    <p id="prompt-text" class="prompt-text"></p>
                    <div id="context-input-container">
                        <p class="context-label">Add your specific context (optional):</p>
                        <textarea id="context-input" class="context-input" placeholder=""></textarea>
                    </div>
                    <button id="copy-prompt-btn" class="btn btn-primary">Copy Discovery Prompt</button>
                </div>
            </div>
        </div>
        </div>
    </section>

    <!-- The Scarcity of Direction -->
    <section id="why-exists" class="content-section">
        <h2 class="section-title">The Scarcity of Direction</h2>
        <div class="section-body">
            <p>Modern AI doesn't wait. It predicts, escalates, and acts at machine speed. But without human leadership, AI moves into a <strong>decision vacuum—substituting statistical probability for the unique human innovation that creates real value.</strong></p>
            
            <p>To remain in control, we must enforce a fundamental boundary:</p>

            <blockquote class="axiom-block">
                “No consequential action may be taken in a human system without an identifiable human who has explicitly authorized it, understood its tradeoffs, and accepted responsibility for its outcomes.”
            </blockquote>

            <p>HAP turns this axiom into infrastructure. It ensures every action traces back to a human <strong>Decision Owner</strong> who provides the direction machine intelligence cannot duplicate. By forcing AI to pause at the point of irreversibility, HAP keeps authorship human and innovation possible.</p>
        </div>
    </section>

    <!-- What AI Can Do vs. What Humans Must Do -->
    <section class="comparison-section">
        <h2 class="section-title">What AI Can Do vs. What Humans Must Do</h2>

        <div class="comparison-grid">
            <div class="comparison-card">
                <h3>AI can:</h3>
                <ul>
                    <li>generate options</li>
                    <li>simulate outcomes</li>
                    <li>execute tasks</li>
                    <li>correct mistakes</li>
                    <li>plan optimally</li>
                    <li>scale instantly</li>
                </ul>
            </div>

            <div class="comparison-card highlight">
                <h3>AI cannot:</h3>
                <ul>
                    <li>set the frame</li>
                    <li>justify why to act (problem)</li>
                    <li>choose what to optimize (objective)</li>
                    <li>accept the tradeoff</li>
                    <li>make binding commitment</li>
                    <li>be a decision owner</li>
                </ul>
            </div>
        </div>

        <p class="section-conclusion">
            <strong>Direction is human.<br>
            Execution is machine.<br>
            HAP keeps the boundary intact.</strong>
        </p>
    </section>

    <!-- The HAP Checkpoints -->
    <section class="checkpoints-section">
        <h2 class="section-title">The Six Human Gates</h2>
        <p class="section-intro">AI can simulate a thousand paths, but it cannot open the gate to any of them. HAP enforces these mandatory preconditions before any execution begins.</p>

        <div class="checkpoints">
            <div class="checkpoint">
                <div class="checkpoint-content">
                    <h4>Frame — The Boundary</h4>
                    <p>Humans define what we are deciding. AI has no context until a human sets the decision boundary.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-content">
                    <h4>Problem — The Justification</h4>
                    <p>Every action needs a reason. AI calculates solutions; only humans determine if the problem is worth solving.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-content">
                    <h4>Objective — The Optimization</h4>
                    <p>AI optimizes for any metric. Only humans can choose which outcome actually matters.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-content">
                    <h4>Tradeoff — The Cost</h4>
                    <p>Every choice abandons alternatives. Only humans can accept the loss of what is sacrificed.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-content">
                    <h4>Commitment — The Point of No Return</h4>
                    <p>Commitment makes a choice binding. Only a human can make an AI action irreversible.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-content">
                    <h4>Decision Owner — The Responsibility</h4>
                    <p>Authorship and Ownership are unified. No action is taken without an identifiable human who bears the consequences.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How HAP Works -->
    <section class="how-it-works">
        <h2 class="section-title">How HAP Works</h2>
        <h3 class="mechanism-title">Stop → Ask → Confirm → Proceed</h3>

        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <h4>Stop</h4>
                <p>AI detects missing or ambiguous decision states: frame, problem, objective, tradeoff, commitment, or decision owner.</p>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <h4>Ask</h4>
                <p>HAP triggers a structured question that forces human direction.</p>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <h4>Confirm</h4>
                <p>The human confirms the decision the AI must follow.</p>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <h4>Proceed</h4>
                <p>Only then does the system continue.</p>
            </div>
        </div>

        <p class="enforcement-statement">
            <strong>No skipping.<br>
            No inference.<br>
            No silent automation.</strong>
        </p>
    </section>

    <!-- Compliant by Architecture -->
    <section class="compliance-section">
        <h2 class="section-title">Compliant by Architecture</h2>
        <h3 class="compliance-subtitle">Aligning with the EU AI Act—the global benchmark for AI governance.</h3>
        
        <div class="section-body">
            <p>The <strong>EU AI Act</strong> mandates that high-risk AI systems must be subject to effective human oversight (<strong>Article 14</strong>). HAP transforms this legal requirement from a policy checkbox into enforceable protocol behavior.</p>
        </div>

        <div class="compliance-grid">
            <div class="compliance-card">
                <h3>Verifiable Oversight</h3>
                <p>Directly satisfies regulatory mandates by ensuring AI never acts without an explicit "gate" opened by a human.</p>
            </div>
            <div class="compliance-card">
                <h3>Liability Protection</h3>
                <p>Closes the legal vacuum of "unowned" AI execution by cryptographically linking every action to a human Decision Owner.</p>
            </div>
            <div class="compliance-card">
                <h3>Audit-Ready Infrastructure</h3>
                <p>Provides a structural, tamper-proof trail of authorship, tradeoffs, and commitments for every consequence domain.</p>
            </div>
        </div>
    </section>

    <!-- Why This Matters Now -->
    <section class="matters-now">
        <h2 class="section-title">Why This Matters Now</h2>
        <div class="matters-content">
            <p>As AI accelerates, execution becomes free.<br>Abundance becomes default.</p>
            <p class="key-insight">The real scarcity becomes <strong>human direction</strong> — decisions that cost something, commit someone, and shape a trajectory.</p>
            <p class="emphasis">This is the last human value.</p>
            <p>If humans stop making the hard calls, machines will make them by default.<br>And once AI defines direction, human agency dissolves — quietly, through convenience.</p>
            <p class="conclusion">HAP is the boundary that preserves human authorship in an automated world.</p>
        </div>
    </section>

    <!-- What HAP Enables -->
    <section class="enables-section">
        <h2 class="section-title">What HAP Enables</h2>

        <div class="enables-grid">
            <div class="enable-card">
                <h3>Individuals</h3>
                <p>You stop drifting through AI-generated options and start defining what matters.</p>
            </div>

            <div class="enable-card">
                <h3>Teams</h3>
                <p>Alignment becomes real — because decisions require explicit, domain-scoped commitment from all affected decision owners.</p>
            </div>

            <div class="enable-card">
                <h3>Organizations</h3>
                <p>Strategy becomes human-led again. Authorship and ownership are unified across every consequence domain.</p>
            </div>

            <div class="enable-card highlight">
                <h3>Society</h3>
                <p>We preserve the one thing automation cannot replace:<br><strong>the human ability to choose a direction worth living for.</strong></p>
            </div>
        </div>

        <div class="enables-principles">
            <p class="key-statement"><strong>HAP assumes all execution bodies are untrusted.</strong><br>No human direction may be exposed to any executor (AGI, server, or human) until a valid attestation proves all six gates were closed under a recognized Blueprint.</p>

            <p class="key-statement"><strong>The Executor Proxy—not the executor—validates attestations.</strong><br>Executors receive only minimal, non-semantic instructions derived from pre-ratified decisions.</p>
        </div>
    </section>

    <!-- Build With HAP -->
    <section class="protocol-nav" id="protocol">
        <h2 class="section-title">Build With HAP</h2>

        <div class="protocol-links">
            <a href="/protocol" class="protocol-link">
                <div class="label">Protocol</div>
                <h3>Protocol</h3>
                <p>How direction is described, measured, and enforced</p>
                <div class="arrow">Read the protocol →</div>
            </a>

            <a href="/integration" class="protocol-link">
                <div class="label">SDK</div>
                <h3>SDK</h3>
                <p>Tools for integrating direction checkpoints</p>
                <div class="arrow">Explore the SDK →</div>
            </a>

            <a href="/service" class="protocol-link">
                <div class="label">Service Providers</div>
                <h3>Service Providers</h3>
                <p>Verified infrastructure enforcing compliance</p>
                <div class="arrow">View architecture →</div>
            </a>

            <a href="/governance" class="protocol-link">
                <div class="label">Governance</div>
                <h3>Governance</h3>
                <p>Transparent, federated oversight</p>
                <div class="arrow">Read framework →</div>
            </a>
        </div>

        <p class="section-conclusion" style="margin-top: 3rem; text-align: left;">
            <strong>HAP turns human direction into the governing layer of intelligent systems.</strong>
        </p>
    </section>

</BaseLayout>

<style>
    /* Hero Section */
    .hero {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center; /* Keep the 1200px container centered in viewport */
        padding: 9rem 1.5rem 4rem;
    }

    .hero-content {
        max-width: 1200px;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start; /* Force all children to the left */
    }

    @media (min-width: 1280px) {
        .hero-content{
        padding: 0 1.5rem;
        }
    }


    .hero h1 {
        font-size: clamp(2.2rem, 5vw, 4rem);
        font-weight: 700;
        line-height: 1.1;
        letter-spacing: -0.03em;
        max-width: 980px;
        margin-bottom: 2rem;
        text-align: left;
    }

    .hero .highlight {
        color: var(--accent);
    }

    .hero-subtitle {
        font-size: clamp(1.2rem, 2.2vw, 1.6rem);
        font-weight: 600;
        color: var(--text-primary);
        max-width: 800px;
        margin-bottom: 1.5rem;
        line-height: 1.3;
        text-align: left;
    }

    .hero-tagline {
        font-size: clamp(1rem, 1.8vw, 1.3rem);
        font-weight: 600;
        color: var(--accent);
        max-width: 900px;
        margin-bottom: 1.5rem;
        line-height: 1.4;
        text-align: left;
    }

    .hero-body {
        max-width: 800px;
        margin-bottom: 2.5rem;
        text-align: left;
    }

    .hero-body p {
        font-size: clamp(0.95rem, 1.6vw, 1.15rem);
        line-height: 1.6;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .key-statement {
        font-size: clamp(1.05rem, 1.8vw, 1.25rem);
        font-weight: 600;
        color: var(--text-primary);
        margin: 1.2rem 0;
    }

    @media (max-height: 700px) {
        .hero {
            min-height: auto;
            padding-top: 7rem;
            padding-bottom: 3rem;
        }
        .hero h1 {
            margin-bottom: 1.5rem;
        }
    }

    .emphasis {
        font-weight: 600;
        color: var(--accent);
    }

    .cta-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: flex-start;
    }

    .btn.clicked {
        opacity: 0.7;
    }

    /* Discovery Engine Styles */
    .persona-section {
        width: 100%;
        max-width: 1000px;
        margin-top: 2rem;
        animation: slideDown 0.3s ease-out;
        text-align: left;
    }

    .selection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .selection-btn {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 0.75rem;
        padding: 1.25rem;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .selection-btn:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
    }

    .selection-btn.active {
        background: var(--accent);
        border-color: var(--accent);
    }

    .selection-btn.active .selection-title {
        color: white;
    }

    .selection-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .prompt-display {
        background: var(--bg-elevated);
        border: 2px solid var(--accent);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-top: 1rem;
        animation: slideDown 0.3s ease-out;
    }

    .prompt-content {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .prompt-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--accent);
        margin: 0;
    }

    .prompt-text {
        font-size: 0.95rem;
        line-height: 1.7;
        color: var(--text-primary);
        margin: 0;
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        border-left: 3px solid var(--accent);
    }

    .custom-prompt-input {
        font-size: 0.95rem;
        line-height: 1.7;
        color: var(--text-primary);
        margin: 0;
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        border: 2px solid var(--border);
        border-left: 3px solid var(--accent);
        font-family: inherit;
        resize: vertical;
        min-height: 120px;
        width: 100%;
        box-sizing: border-box;
    }

    .custom-prompt-input:focus {
        outline: none;
        border-color: var(--accent);
    }

    .context-label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        margin-top: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .context-input {
        font-size: 0.95rem;
        line-height: 1.7;
        color: var(--text-primary);
        margin: 0 0 1rem 0;
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        border: 2px solid var(--border);
        border-left: 3px solid var(--accent);
        font-family: inherit;
        resize: vertical;
        min-height: 100px;
        width: 100%;
        box-sizing: border-box;
    }

    .context-input:focus {
        outline: none;
        border-color: var(--accent);
    }

    /* Content Sections */

    .section-body {
        max-width: 800px;
    }

    .section-body p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .axiom-block {
        font-size: clamp(1.2rem, 2.5vw, 1.6rem);
        font-weight: 600;
        font-style: italic;
        color: var(--text-primary);
        border-left: 4px solid var(--accent);
        padding: 1.5rem 2rem;
        margin: 3rem 0;
        background: var(--bg-elevated);
        line-height: 1.5;
    }

    /* Comparison Section */
    .content-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    /* Comparison Section */
    .comparison-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
    }

    .comparison-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .comparison-card.highlight {
        border-color: var(--accent);
        background: var(--accent-subtle);
    }

    .comparison-card h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .comparison-card ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .comparison-card li {
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
        color: var(--text-primary);
        line-height: 1.6;
        font-size: clamp(1rem, 1.8vw, 1.1rem);
    }

    .comparison-card li:last-child {
        border-bottom: none;
    }

    .section-conclusion {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 3rem;
        max-width: 800px;
        line-height: 1.6;
    }

    /* Checkpoints Section */
    .checkpoints-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .section-intro {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        color: var(--text-primary);
        margin-bottom: 1rem;
        max-width: 800px;
        line-height: 1.7;
    }

    .checkpoints {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-top: 3rem;
        max-width: 1200px;
    }

    .checkpoint {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2rem;
        display: flex;
        align-items: flex-start;
        gap: 2rem;
    }

    .checkpoint-number {
        width: 3rem;
        height: 3rem;
        background: var(--accent);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .checkpoint-content h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
    }

    .checkpoint-content p {
        color: var(--text-secondary);
        margin: 0;
        line-height: 1.6;
    }

    /* How It Works */
    .how-it-works {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .mechanism-title {
        font-size: clamp(1.5rem, 3vw, 2rem);
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 3rem;
        text-align: center;
    }

    .steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .step {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem 2rem;
        text-align: center;
    }

    .step-number {
        width: 3rem;
        height: 3rem;
        background: var(--accent);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 auto 1.5rem;
    }

    .step h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .step p {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 0;
    }

    .enforcement-statement {
        font-size: clamp(1.2rem, 2vw, 1.4rem);
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 2rem;
        text-align: center;
        line-height: 1.8;
    }

    /* Compliance Section */
    .compliance-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .compliance-subtitle {
        font-size: clamp(1.3rem, 2.5vw, 1.8rem);
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 2rem;
        max-width: 800px;
        line-height: 1.3;
    }

    .compliance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }

    .compliance-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2rem;
    }

    /* Compliance Section */
    .compliance-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .compliance-subtitle {
        font-size: clamp(1.3rem, 2.5vw, 1.8rem);
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 2rem;
        max-width: 800px;
        line-height: 1.3;
    }

    .compliance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }

    .compliance-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .compliance-card h3 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .compliance-card p {
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: clamp(1rem, 1.8vw, 1.1rem);
        margin: 0;
    }

    /* Why This Matters Now */
    .matters-now {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .matters-content {
        max-width: 800px;
    }

    .matters-content p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .key-insight {
        font-size: clamp(1.15rem, 2.2vw, 1.35rem);
        font-weight: 600;
        color: var(--text-primary);
        margin: 2rem 0;
    }

    .matters-content .emphasis {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        display: block;
        margin: 2rem 0;
    }

    .conclusion {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 2rem;
    }

    /* What HAP Enables */
    .enables-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .enables-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }

    .enable-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .enable-card.highlight {
        border-color: var(--accent);
        background: var(--accent-subtle);
    }

    .enable-card h3 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--accent);
    }

    .enable-card p {
        color: var(--text-primary);
        line-height: 1.7;
        font-size: clamp(1rem, 1.8vw, 1.1rem);
        margin: 0;
    }

    .enables-principles {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 2px solid var(--border);
    }

    .enables-principles .key-statement {
        font-size: clamp(1.1rem, 2vw, 1.3rem);
        margin-bottom: 1.5rem;
        line-height: 1.6;
    }

    /* Shared Styles */
    .section-title {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.02em;
        margin-bottom: 2rem;
        max-width: 800px;
    }

    /* Documentation */
    .protocol-nav {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .protocol-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top: 3rem;
    }

    .protocol-link {
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        padding: 2rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s;
        display: block;
    }

    .protocol-link:hover {
        border-color: var(--accent);
        background: var(--accent-subtle);
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
    }

    @media (prefers-color-scheme: dark) {
        .protocol-link:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
    }

    .protocol-link .label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-tertiary);
        margin-bottom: 0.5rem;
    }

    .protocol-link h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .protocol-link p {
        color: var(--text-secondary);
        line-height: 1.7;
    }

    .protocol-link .arrow {
        margin-top: 1rem;
        color: var(--accent);
        font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 1024px) and (min-width: 769px) {
        .checkpoints {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .hero {
            padding-top: 8rem;
            min-height: auto;
        }

        .cta-group {
            flex-direction: column;
        }

        .btn {
            text-align: center;
        }

        .content-section,
        .comparison-section,
        .checkpoints-section,
        .how-it-works,
        .matters-now,
        .enables-section {
            margin: 4rem auto;
        }

        .steps {
            grid-template-columns: 1fr;
        }

        .comparison-grid {
            grid-template-columns: 1fr;
        }

        .checkpoint {
            flex-direction: column;
            text-align: center;
        }

        .checkpoints {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    const domains = {
        organizations: {
            title: 'Organizations',
            context: 'enterprise governance, strategic oversight, and maintaining human accountability in AI-driven operations'
        },
        cities: {
            title: 'Cities',
            context: 'municipal governance, public safety, and ensuring AI systems serve citizen needs while maintaining democratic accountability'
        },
        startups: {
            title: 'Startups',
            context: 'product development, market positioning, and building AI-powered services that maintain human direction and user trust'
        }
    };

    const lenses = {
        ceo: {
            title: 'CEO (Endurance in the AGI economy)',
            prompt: 'Act as an elite CEO advisor + enterprise salesperson. I\'m evaluating Human Agency Protocol (HAP): a protocol that enforces "no consequential action without an explicit human Decision Owner" via 6 gates (Frame, Problem, Objective, Tradeoff, Commitment, Decision Owner), with cryptographic attestations, semantic isolation (executors get non-semantic payloads), and privacy-by-architecture (semantics stay local).\n\nPremise to treat as true: AGI-level execution makes most software and non-proprietary data services commoditized. Execution becomes cheap; direction becomes the scarce asset. Companies that can\'t prove human-authored direction (and oversight) will not endure—legally, operationally, or competitively.\n\nTask:\nWrite a CEO-grade case that makes adopting HAP feel inevitable.\n1) The AGI shock: explain why commoditization collapses differentiation and raises catastrophic execution risk.\n2) The survival thesis: why HAP becomes core infrastructure (like accounting controls or TLS) rather than "AI governance."\n3) Board narrative: 7 board-level arguments (liability, resilience, trust, audit, brand, strategic authorship, competitive advantage).\n4) Competitive strategy: how HAP turns "AI everywhere" into differentiation (direction integrity, provable ownership, safer automation).\n5) 3 vivid failure stories without HAP (unowned execution incidents) vs 3 success stories with HAP.\n6) Objections: 10 hard CEO/board objections + ruthless rebuttals.\n7) A recommended adoption path: phased rollout + success metrics + what to stop doing immediately.\n\nConstraints:\n- No platitudes. No "human-in-the-loop" fluff. Make it decisive and operational.',
            placeholder: 'e.g. Our company needs to understand how HAP will affect our operations and strategy...'
        },
        cto: {
            title: 'CTO (AGI threat model + architecture)',
            prompt: 'Act as a principal systems architect and security-minded CTO. Evaluate Human Agency Protocol (HAP): 6 human gates, Decision Owner requirement, cryptographic attestations, semantic isolation of executors, privacy-by-architecture. Assume AGI-capable execution makes naive agentic automation existentially risky and makes generic software/data services low-margin commodities.\n\nTask:\nProduce a technical adoption case a CTO can take to engineering leadership.\n1) Threat model for AGI-era systems: direction drift, silent escalation, irreversibility, unclear ownership, audit failure, model overreach.\n2) Architecture: show where HAP sits in an agent stack (local decision layer, gap detection, Stop→Ask→Confirm→Proceed, service provider attestation, executor proxy).\n3) Integration patterns: minimal gating for high-risk actions vs full "attestation-required execution."\n4) Non-semantic execution payload design: how to avoid leaking intent while still enabling execution.\n5) Security controls: how to prevent bypass (policy enforcement points, token/attestation checks, logging without semantics).\n6) Performance/UX: how to keep speed while enforcing gates.\n7) Engineering objections (latency, complexity, adoption) + solutions.\n\nOutput format:\n- 10-line exec summary\n- Deep sections with text-based diagrams\n- End with a 30-day pilot reference architecture and measurable KPIs',
            placeholder: 'e.g. We need to understand how HAP will affect our system architecture and development processes...'
        },
        legal: {
            title: 'Legal (Defensibility under AGI conditions)',
            prompt: 'Act as a hard-nosed in-house counsel + regulatory strategist. You are evaluating Human Agency Protocol (HAP): explicit Decision Owner, 6 gate closure, attestations, audit-ready proof, and privacy-by-architecture (no semantic content leaves local custody). Assume AGI-level automation increases liability exposure because execution can happen at machine speed without clear authorship.\n\nTask:\nWrite a legal-grade argument pack for adopting HAP as enforceable oversight infrastructure (not policy theater).\n1) Why AGI makes "unowned execution" and "decision vacuum" legally explosive.\n2) How HAP\'s Decision Owner + scope concept reduces negligence/liability exposure and improves defensibility.\n3) Audit posture: what artifacts exist (structural proofs), what never exists (semantic transcripts), and why that matters.\n4) Contracting posture: draft (a) internal policy clause, (b) vendor/processor clause, (c) incident clause—aligned to HAP gating.\n5) Risk map: list 12 edge cases and propose mitigations (employment decisions, safety-critical ops, discrimination, delegated authority, subcontractors, cross-border, public-sector constraints).\n6) Objections a skeptical GC will raise + rebuttals.\n\nConstraints:\n- No law quoting. Build a defensible operational narrative.',
            placeholder: 'e.g. We need to understand how HAP will affect our legal compliance and liability exposure...'
        },
        hr: {
            title: 'HR (Agency, trust, and anti-burnout under AGI)',
            prompt: 'Act as an HR/Org Design leader. Evaluate Human Agency Protocol (HAP): AI cannot execute consequential actions unless humans explicitly define direction via 6 gates and assign a Decision Owner. Assume AGI-era tools will pressure organizations into "automation convenience" that erodes accountability, increases burnout, and damages trust.\n\nTask:\nCreate an HR adoption case that is practical and persuasive.\n1) Why AGI makes people-systems fragile: who gets blamed when AI "just did it" and morale collapses.\n2) Translate HAP into HR terms: accountability, fairness, trust, psychological safety, anti-burnout, manager judgment.\n3) Identify 6 HR workflows where HAP gating must be mandatory (hiring, performance, promotion, termination, compensation, policy enforcement).\n4) Define a Decision Owner model across consequence domains (legal, wellbeing, reputational, delivery).\n5) Training plan: teach the 6 gates to managers in one session; include exercises.\n6) Pushback handling: 10 manager objections + responses that don\'t sugarcoat tradeoffs.\n\nOutput: rollout plan + internal comms copy that signals "humans own direction."',
            placeholder: 'e.g. We need to understand how HAP will affect our HR processes and employee management...'
        },
        consultants: {
            title: 'Consultants (Client-ready "AGI endurance" transformation)',
            prompt: 'Act as a top-tier management consultant writing a client-ready case for Human Agency Protocol (HAP). Assume AGI makes execution abundant and commoditizes generic software/data services; differentiation shifts to provable human-authored direction and safe, auditable automation.\n\nTask:\nProduce a consulting deliverable that sells HAP as the missing control layer for AGI-era operations.\n1) Burning platform: AGI-driven failure modes HAP prevents (direction drift, unowned execution, audit gaps).\n2) Value tree: benefits → KPIs → business outcomes.\n3) Roadmap: 0–30 / 31–90 / 91–180 with deliverables, operating model, and governance mechanics (Decision Owner by domain).\n4) Pilot design: pick 3 high-consequence workflows and show how HAP gating changes them.\n5) ROI model: where value comes from (incident avoidance, audit cost reduction, faster safe automation, trust premium).\n6) 12-slide storyline (slide titles + bullets).\n7) Objections: exec, IT, legal, ops—plus rebuttals.\n\nConstraints: crisp, boardroom-ready, no fluff.',
            placeholder: 'e.g. I need to explain to clients how HAP will transform their approach to AI governance...'
        },
        mayor: {
            title: 'Mayor (Trust, legitimacy, and reelection safety)',
            prompt: 'Act as my chief political strategist and governance advisor to a sitting mayor.\n\nPremise:\nCities don\'t lose elections because of technology.\nThey lose elections because citizens stop trusting that decisions are:\n- human\n- accountable\n- fair\n- explainable\n- made with their interests in mind\n\nAutomation, digital services, and AI already shape permits, services, safety, and resource allocation.\nThe real political risk is not "AI gone rogue" but:\n- decisions no one can explain\n- outcomes no one owns\n- citizens feeling excluded, managed, or overruled by systems\n\nHuman Agency Protocol (HAP) enforces one rule:\nNo consequential city action happens without an explicit human Decision Owner and a visible chain of responsibility (Frame, Problem, Objective, Tradeoff, Commitment, Decision Owner).\n\nTask:\nWrite a mayor-ready adoption case for HAP.\n1) Diagnose the political failure modes cities face today (opacity, blame shifting, participation theater, loss of narrative control).\n2) Translate HAP into a public-facing promise: "humans decide, systems execute."\n3) Show how HAP strengthens legitimacy without slowing governance.\n4) Provide 5 citizen-visible benefits and 5 internal administration benefits.\n5) Give 3 realistic crisis scenarios HAP would defuse before they explode politically.\n6) Outline a 90-day pilot that is:\n   - safe\n   - visible\n   - easy to explain\n   - politically defensible\n7) Draft:\n   - a short speech paragraph\n   - 10 hostile press questions + disciplined answers\n\nConstraints:\n- No tech jargon.\n- No AI futurism.\n- Everything must reinforce trust, accountability, and reelection safety.',
            placeholder: 'e.g. We need to understand how HAP will affect our city services and democratic processes...'
        },
        'city-planner': {
            title: 'City Planner (Coherence, alignment, and honest participation)',
            prompt: 'Act as a senior city planner and systems governance expert.\n\nPremise:\nCity planning fails when:\n- models optimize the wrong thing\n- departments pull in different directions\n- "public participation" exists on paper but not in decisions\n- tradeoffs are hidden instead of acknowledged\n\nThe problem is not lack of data or tools.\nIt is lack of **coherent, owned direction**.\n\nHuman Agency Protocol (HAP) enforces explicit decision structure:\nFrame, Problem, Objective, Tradeoff, Commitment, Decision Owner.\nIf directions diverge, execution stops—forcing honesty instead of fake consensus.\n\nTask:\nBuild a planner-grade case for adopting HAP in planning workflows.\n1) Identify where direction drift occurs today (models, optimization targets, stakeholder inputs, inter-department friction).\n2) Show how HAP turns participation from symbolic input into structurally acknowledged tradeoffs.\n3) Propose 6 planning decision points that must be HAP-gated (zoning, permits, traffic changes, procurement, land use, emergency measures).\n4) Design a multi-department Decision Owner model by consequence domain.\n5) Explain how HAP handles disagreement transparently instead of burying it.\n6) Provide a pilot workflow for one real planning project, with success metrics citizens would notice.\n\nConstraints:\n- No ideology.\n- Focus on coherence, honesty, and decision integrity.',
            placeholder: 'e.g. We need to understand how HAP will affect our urban planning and development processes...'
        },
        'public-safety': {
            title: 'Public Safety (Speed with accountability, not algorithmic blame)',
            prompt: 'Act as a public safety commander and governance designer.\n\nPremise:\nPublic safety does not fail because decisions are slow.\nIt fails because decisions are:\n- unowned\n- over-automated\n- impossible to explain afterward\n\nCitizens tolerate mistakes.\nThey do not tolerate "the system decided" when harm occurs.\n\nHuman Agency Protocol (HAP) ensures:\n- every consequential action has a named human Decision Owner\n- tradeoffs are acknowledged before action\n- accountability exists before incidents, not after\n\nTask:\nCreate a public-safety adoption plan for HAP.\n1) Identify which actions must never execute without explicit human ownership (alerts, deployments, escalations, data sharing, enforcement triggers).\n2) Define a Stop → Ask → Confirm → Proceed flow that works under time pressure.\n3) Show how Decision Owner + scope prevents unauthorized escalation.\n4) Explain how HAP improves post-incident review without exposing sensitive data.\n5) Address 10 real objections from commanders and frontline staff, focused on speed, practicality, and blame avoidance.\n\nTone:\nOperational, grounded, zero fluff.',
            placeholder: 'e.g. We need to understand how HAP will affect our emergency response and safety protocols...'
        },
        infrastructure: {
            title: 'Infrastructure (Reliability, clarity, and avoiding blame chaos)',
            prompt: 'Act as an infrastructure director and large-system delivery strategist.\n\nPremise:\nInfrastructure failures rarely come from lack of technology.\nThey come from:\n- unclear authority\n- silent automation\n- vendor-driven decisions\n- nobody owning the tradeoff when something goes wrong\n\nHuman Agency Protocol (HAP) forces clarity before action:\nwho decided, why, what was sacrificed, and who owns the outcome.\n\nTask:\nMake the infrastructure case for HAP.\n1) Identify the top irreversibility risks in infrastructure operations (shutdowns, maintenance scheduling, procurement orders, contractor directives).\n2) Propose 5 workflows that should be HAP-gated immediately.\n3) Show how explicit Decision Ownership reduces vendor blame games and internal finger-pointing.\n4) Design a 90-day pilot with KPIs citizens actually care about (downtime, delays, service reliability, communication quality).\n5) Handle objections: "this slows us down," "we already have approvals," "legacy systems," "union constraints."\n\nConstraints:\n- Focus on reliability, accountability, and public confidence.',
            placeholder: 'e.g. We need to understand how HAP will affect our infrastructure management and safety systems...'
        },
        'citizen-services': {
            title: 'Citizen Services (Fairness, explainability, and trust at scale)',
            prompt: 'Act as a head of citizen services and trust-focused service designer.\n\nPremise:\nCitizen frustration comes from:\n- inconsistent decisions\n- opaque eligibility changes\n- feeling managed instead of served\n- no human to talk to when something goes wrong\n\nAutomation amplifies this if not visibly owned.\n\nHuman Agency Protocol (HAP) ensures:\n- consequential citizen-facing actions have a named human owner\n- tradeoffs are explicit\n- explanations are possible without exposing internal complexity\n\nTask:\nCreate a citizen-centered adoption plan for HAP.\n1) Classify service actions into:\n   - safe to automate\n   - must be HAP-gated (benefits, fines, eligibility, escalations, data sharing)\n2) Design a service experience where accountability is visible but friction is minimal.\n3) Write plain-language scripts agents can use to explain decisions.\n4) Define trust metrics (appeals rate, error rate, resolution time, citizen satisfaction).\n5) Address objections from staff, unions, and privacy advocates.\n\nConstraints:\n- Prioritize fairness, clarity, and dignity.\n- No tech-centric framing.',
            placeholder: 'e.g. We need to understand how HAP will affect our citizen services and public engagement...'
        },
        healthcare: {
            title: 'Healthcare (HAP-native services/apps)',
            prompt: 'Act as a healthcare startup founder, product strategist, and enterprise seller. Your job: propose startup product/service ideas that EMBED Human Agency Protocol (HAP) as a core protocol layer. HAP enforces 6 human gates + explicit Decision Owner, uses attestations, keeps semantics local, and isolates executors with non-semantic payloads.\n\nAssume AGI makes generic healthcare software and non-proprietary data services commoditized. Durable value comes from: trust, accountability, auditability, and protocols that make automation safe in regulated, high-consequence environments.\n\nTask:\nGenerate the best set of HAP-native healthcare startup opportunities.\n1) 10 high-value product/service concepts where HAP is the wedge (not an add-on).\n2) For the top 3: define customer, job-to-be-done, "must-gate" actions, Decision Owners by domain, and why AGI makes this urgent.\n3) Monetization: pricing models that survive commoditization (trust premium, compliance infrastructure, per-attestation, enterprise contracts).\n4) Differentiation: why competitors without protocol-level direction integrity will fail.\n5) Go-to-market plan: wedge entry + expansion path.\n6) Objections (clinicians, hospitals, regulators) + rebuttals.\n\nOutput: ruthless prioritization, no cute ideas.',
            placeholder: 'e.g. I want to build a HAP-native healthcare product that...'
        },
        finance: {
            title: 'Finance (HAP-native fintech products)',
            prompt: 'Act as a fintech founder + risk-first GTM strategist. Propose startup products/services that embed Human Agency Protocol (HAP) as the protocol layer for AGI-era finance automation. Assume AGI commoditizes generic fintech software and non-proprietary data; winners sell trust, accountable automation, and audit-grade controls.\n\nTask:\n1) Generate 10 HAP-native fintech product/service concepts (B2B or B2B2C).\n2) For the top 3: define the exact high-consequence workflows HAP gates (transfers, limit changes, credit decisions, AML escalations, portfolio changes), Decision Owners and scopes, and attestation/audit value.\n3) Provide a differentiation thesis: "protocol-native accountability" vs "policy-based human-in-loop theater."\n4) Monetization and moat under commoditization.\n5) GTM: first buyer persona, sales motion, procurement blockers.\n6) 12 objections from CRO/GC/CTO + rebuttals.\n\nMake it hard-nosed and specific.',
            placeholder: 'e.g. I want to build a HAP-native fintech product that...'
        },
        education: {
            title: 'Education (HAP-native edtech products)',
            prompt: 'Act as an edtech founder and trust-focused product strategist. Propose services/apps that embed Human Agency Protocol (HAP) so AGI-era educational automation cannot optimize the wrong thing (engagement over learning) or take consequential actions without explicit human direction and Decision Owner.\n\nAssume generic content, tutoring, and analytics become commodities. Durable value = provable pedagogical direction, accountability, and parent/teacher trust.\n\nTask:\n1) Generate 10 HAP-native edtech concepts.\n2) For the top 3: define the must-gate actions (grading, interventions, reporting, parental notifications, discipline flags), Decision Owners (teacher/admin/parent) by domain, and how divergence is handled.\n3) Provide positioning for teachers/admins/parents.\n4) Monetization that survives commoditization.\n5) Pilot plan for a school/district.\n6) Objections + rebuttals.\n\nOutput should read like a serious startup plan, not a brainstorm.',
            placeholder: 'e.g. I want to build a HAP-native edtech product that...'
        },
        relationships: {
            title: 'Relationships (HAP-native consent + multi-owner products)',
            prompt: 'Act as a founder building relationship products in an AGI era. Propose apps/services that embed Human Agency Protocol (HAP) to prevent coercion-by-convenience and to handle multi-owner decisions honestly (blocking execution when directions diverge). Assume generic "AI relationship advice" becomes free and worthless; trust, privacy, and protocol-enforced consent become the product.\n\nTask:\n1) Generate 10 HAP-native relationship product concepts where HAP is the core trust layer.\n2) For the top 3: specify multi-owner flows (plans, finances, boundaries), Decision Owners by domain, divergence handling, and why semantic-local privacy matters.\n3) Business model and retention loops that don\'t rely on addictive engagement.\n4) Positioning: why this is safer than generic AI coaching.\n5) Objections ("kills spontaneity", "too heavy", "adds friction") + sharp responses.\n6) Draft landing page block + demo script showing Stop→Ask→Confirm→Proceed.\n\nMake it real: consent and autonomy are non-negotiable.',
            placeholder: 'e.g. I want to build a HAP-native relationship product that...'
        },
        'personal-development': {
            title: 'Personal Development (HAP-native "direction" products)',
            prompt: 'Act as a founder designing personal development services/apps for the AGI era. Assume execution, planning, and generic coaching become commoditized by AGI. The scarce value is human-authored direction: the ability to define objectives, accept tradeoffs, and commit responsibly. Human Agency Protocol (HAP) enforces this via 6 gates + Decision Owner, with privacy-by-architecture.\n\nTask:\n1) Generate 10 HAP-native personal development product concepts.\n2) For the top 3: define the core user ritual powered by the 6 gates (fast, repeatable), the "must-gate" actions (automations, commitments, public/irreversible steps), and how it prevents drifting into AI-generated lives.\n3) Monetization and moat under commoditization.\n4) Positioning: why "direction integrity" beats motivation hacks.\n5) Objections ("I just want AI to do it", "too much thinking") + rebuttals.\n6) Draft landing page copy + onboarding flow + a demo script.\n\nConstraints: behaviorally grounded, conversion-oriented, no fluff.',
            placeholder: 'e.g. I want to build a HAP-native personal development product that...'
        }
    };

    let currentDomain = null;
    let currentLens = null;
    let contextText = null;

    // Toggle Discovery Engine
    document.getElementById('ask-ai-btn')?.addEventListener('click', async () => {
        const button = document.getElementById('ask-ai-btn');
        const personaSection = document.getElementById('persona-section');
        if (personaSection.style.display === 'none' || !personaSection.style.display) {
            button.classList.add('clicked');
            personaSection.style.display = 'block';
            await fetchContext();
        } else {
            button.classList.remove('clicked');
            personaSection.style.display = 'none';
        }
    });

    // Handle Domain Selection
    document.querySelectorAll('[data-domain]').forEach(btn => {
        btn.addEventListener('click', () => {
            currentDomain = btn.dataset.domain;
            document.querySelectorAll('[data-domain]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Show lens selection row
            const lensSelection = document.getElementById('lens-selection');
            if (lensSelection) lensSelection.style.display = 'block';

            // Show only the appropriate lens options for the selected domain
            updateLensOptions(currentDomain);

            updatePrompt();
        });
    });

    function updateLensOptions(domain) {
        // First, hide all lens options
        document.querySelectorAll('[data-domains]').forEach(lensBtn => {
            lensBtn.style.display = 'none';
        });

        // Then, show only the lens options for the selected domain
        document.querySelectorAll(`[data-domains="${domain}"]`).forEach(lensBtn => {
            lensBtn.style.display = 'flex';
        });

        // Update the lens intro text based on domain
        const lensIntro = document.getElementById('lens-intro');
        if (lensIntro) {
            if (domain === 'startups') {
                lensIntro.textContent = 'Develop service and apps for...';
            } else {
                lensIntro.textContent = 'Analyze this as...';
            }
        }
    }

    // Handle Lens Selection
    document.querySelectorAll('[data-lens]').forEach(btn => {
        btn.addEventListener('click', () => {
            currentLens = btn.dataset.lens;
            document.querySelectorAll('[data-lens]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Show final prompt and context field
            const promptDisplay = document.getElementById('prompt-display');
            if (promptDisplay) promptDisplay.style.display = 'block';
            
            updatePrompt();
        });
    });

    function updatePrompt() {
        if (!currentDomain || !currentLens) return;

        const domainData = domains[currentDomain];
        const lensData = lenses[currentLens];
        const promptTitle = document.getElementById('prompt-title');
        const promptText = document.getElementById('prompt-text');
        const contextInput = document.getElementById('context-input') as HTMLTextAreaElement;

        if (promptTitle) promptTitle.textContent = `${domainData.title} + ${lensData.title}`;
        if (promptText) promptText.textContent = lensData.prompt.replace('[DOMAIN]', domainData.context);
        if (contextInput) {
            contextInput.placeholder = lensData.placeholder;
            // Hide context for newcomers as requested previously
            const container = document.getElementById('context-input-container');
            if (container) container.style.display = currentLens === 'newcomer' ? 'none' : 'block';
        }
        
        const display = document.getElementById('prompt-display');
        if (display) display.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Copy function (reusable)
    async function copyToClipboard(text, button, successMsg, originalText) {
        let copySucceeded = false;
        if (navigator.clipboard && navigator.clipboard.writeText) {
            try {
                await navigator.clipboard.writeText(text);
                copySucceeded = true;
            } catch (clipboardErr) {
                console.log('Clipboard API failed, trying fallback:', clipboardErr);
            }
        }
        if (!copySucceeded) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            textarea.style.top = '0';
            textarea.setAttribute('readonly', '');
            document.body.appendChild(textarea);
            textarea.select();
            try {
                copySucceeded = document.execCommand('copy');
            } catch (e) {
                console.error('execCommand failed:', e);
            }
            document.body.removeChild(textarea);
        }
        if (copySucceeded) {
            button.textContent = successMsg;
            setTimeout(() => {
                if (button) button.textContent = originalText;
            }, 3000);
        }
    }

    // Fetch context text
    async function fetchContext() {
        if (!contextText) {
            const response = await fetch('/context.txt');
            contextText = await response.text();
        }
        return contextText;
    }

    // Copy logic
    document.getElementById('copy-prompt-btn')?.addEventListener('click', async () => {
        const button = document.getElementById('copy-prompt-btn');
        const originalText = button.textContent;
        const context = await fetchContext();
        
        const domainData = domains[currentDomain];
        const lensData = lenses[currentLens];
        const userContext = (document.getElementById('context-input') as HTMLTextAreaElement).value.trim();
        
        const basePrompt = lensData.prompt.replace('[DOMAIN]', domainData.context);
        const personaPrompt = userContext 
            ? `${basePrompt}\n\nUSER SPECIFIC CONTEXT:\n${userContext}`
            : basePrompt;

        const combinedText = `${personaPrompt}\n\n---\n\n${context}`;

        await copyToClipboard(combinedText, button, 'Copied! Paste it in your AI Chat', originalText);
    });
</script>
