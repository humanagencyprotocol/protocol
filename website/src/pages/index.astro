---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="The Human Agency Protocol - AI Governance. Human Control.">
    <!-- Hero Section -->
    <section class="hero">
        <div class="version-wrapper">
            <span class="version">Version 0.2</span>
            <span class="version-date">November 2025</span>
        </div>
        <h1>The More AI Shapes Our Lives, the More It Must <span class="highlight">Ask Humans First</span></h1>
        <p class="hero-subtitle">A protocol that forces AI to ask humans for meaning, purpose, and intention before it's allowed to act.</p>
        <div class="cta-group">
            <a href="/protocol" class="btn btn-primary">Explore the Protocol</a>
            <button id="copy-context" class="btn btn-secondary">Ask your AI about this protocol</button>
        </div>
    </section>

    <!-- Why This Matters -->
    <section class="why-matters">
        <h2 class="section-title">Why This Matters</h2>
        <div class="why-content">
            <p>
                AI now drafts messages, plans steps, triggers workflows, and increasingly executes full tasks.
            </p>
            <p class="danger-statement">
                The risk isn't malice — it's momentum without clarity:
            </p>
            <p class="danger-inline">
                goals assumed,<br>
                purpose invented,<br>
                actions taken before humans decide what they actually want.
            </p>
            <p class="key-insight">
                That's how authorship disappears.
            </p>
            <p>
                <strong>The Human Agency Protocol prevents this.</strong><br>
                When meaning, purpose, or intention is unclear, AI must stop, ask, and wait.
            </p>
            <p class="emphasis">
                Human intention becomes non-optional.
            </p>
        </div>
    </section>

    <!-- How HAP Works -->
    <section class="how-it-works">
        <h2 class="section-title">How HAP Works</h2>
        <h3 class="mechanism-title">Stop → Ask → Proceed</h3>

        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <h4>Stop</h4>
                <p>The system detects ambiguity, drift, or a skipped stage.</p>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <h4>Ask</h4>
                <p>A context-appropriate question is triggered (an Inquiry Blueprint).</p>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <h4>Proceed</h4>
                <p>Only after the human resolves the checkpoint can the AI continue.</p>
            </div>
        </div>

        <p class="enforcement-statement">
            These checkpoints are enforced. They cannot be bypassed.
        </p>
    </section>

    <!-- Two Inquiry Modes -->
    <section class="inquiry-modes">
        <h2 class="section-title">Two Inquiry Modes</h2>
        <p class="modes-intro">Human thinking has two rhythms. HAP protects both.</p>

        <div class="modes-grid">
            <div class="mode-card">
                <h3>Convergent Mode</h3>
                <p class="mode-purpose">For alignment, planning, and execution.</p>
                <ul>
                    <li>Moves meaning → purpose → intention → action</li>
                    <li>No skipping or fast-forwarding</li>
                    <li>Guarantees human-led closure</li>
                </ul>
            </div>

            <div class="mode-card">
                <h3>Reflective Mode</h3>
                <p class="mode-purpose">For exploration, insight, and creative depth.</p>
                <ul>
                    <li>Cycles between stages without forcing decisions</li>
                    <li>Protects depth from premature action</li>
                    <li>Guarantees human-anchored reflection</li>
                </ul>
            </div>
        </div>

        <p class="modes-rule">
            Both modes follow the same rule:<br>
            <strong>AI cannot advance when orientation is unclear.</strong>
        </p>
    </section>

    <!-- The Inquiry Ladder -->
    <section class="inquiry-ladder">
        <h2 class="section-title">The Inquiry Ladder</h2>
        <p class="ladder-intro">All productive human inquiry follows the same structure:</p>

        <div class="ladder-steps">
            <div class="ladder-step">
                <div class="ladder-number">1</div>
                <div class="ladder-content">
                    <h4>Meaning</h4>
                    <p>Are we talking about the same thing?</p>
                </div>
            </div>

            <div class="ladder-step">
                <div class="ladder-number">2</div>
                <div class="ladder-content">
                    <h4>Purpose</h4>
                    <p>Why does this matter?</p>
                </div>
            </div>

            <div class="ladder-step">
                <div class="ladder-number">3</div>
                <div class="ladder-content">
                    <h4>Intention</h4>
                    <p>What will we do first?</p>
                </div>
            </div>

            <div class="ladder-step">
                <div class="ladder-number">4</div>
                <div class="ladder-content">
                    <h4>Action</h4>
                    <p>How do we execute?</p>
                </div>
            </div>
        </div>

        <div class="ladder-explanation">
            <p>
                HAP enforces progress through these stages.<br>
                When any stage is unresolved, the system must pause and ask.
            </p>
        </div>
    </section>

    <!-- Core Principles -->
    <section class="principles">
        <h2 class="section-title">Core Principles (v0.3)</h2>

        <div class="principles-list">
            <div class="principle-item">
                <h3>Stage Progression Enforcement</h3>
                <p>
                    AI must follow the ladder in the correct order (Convergent) or controlled cycles (Reflective).<br>
                    No jumps. No shortcuts. No inference.
                </p>
            </div>

            <div class="principle-item">
                <h3>Mandatory Human Checkpoints</h3>
                <p>
                    When meaning, purpose, or intention is unclear, AI must stop and ask.<br>
                    Explicit confirmation required.
                </p>
            </div>

            <div class="principle-item">
                <h3>Human-Gated Actions</h3>
                <p>
                    All downstream actions (publishing, deploying, triggering systems) require resolved stages.<br>
                    Higher risk → higher required stage.
                </p>
            </div>

            <div class="principle-item">
                <h3>Two Inquiry Modes</h3>
                <p>
                    Convergent for decisions; Reflective for depth.<br>
                    Both obey stop → ask → proceed.
                </p>
            </div>

            <div class="principle-item">
                <h3>Privacy by Architecture</h3>
                <p>
                    Only structural signals leave the device.<br>
                    Never content. Never transcripts.
                </p>
            </div>

            <div class="principle-item">
                <h3>Blueprinted Questions</h3>
                <p>
                    Questions follow open, shared Inquiry Blueprints.<br>
                    AI chooses wording; the protocol enforces timing.
                </p>
            </div>

            <div class="principle-item">
                <h3>Verified Compliance</h3>
                <p>
                    Every checkpoint and action can be cryptographically proven (HAP Envelope).<br>
                    Proof, not trust.
                </p>
            </div>

            <div class="principle-item">
                <h3>Federated Stewardship</h3>
                <p>
                    Qualified Service Providers enforce the rules without owning data.<br>
                    No central authority. No extraction.
                </p>
            </div>
        </div>
    </section>

    <!-- Why This Matters Now -->
    <section class="matters-now">
        <h2 class="section-title">Why This Matters Now</h2>
        <div class="matters-content">
            <p class="matters-lead">
                Automation accelerates. Human intention becomes scarce.
            </p>
            <p><strong>HAP ensures:</strong></p>
            <ul class="ensures-list">
                <li>AI cannot assume your goals</li>
                <li>AI cannot skip clarification</li>
                <li>AI cannot act without your direction</li>
                <li>AI cannot run ahead of your understanding</li>
            </ul>
            <p class="matters-conclusion">
                The right question, asked at the right time, keeps humans in the loop — by design, not by hope.
            </p>
        </div>
    </section>

    <!-- Documentation -->
    <section class="protocol-nav" id="protocol">
        <h2 class="section-title">Complete Specification</h2>

        <div class="protocol-links">
            <a href="/protocol" class="protocol-link">
                <div class="label">Core</div>
                <h3>The Protocol</h3>
                <p>How agency is described, measured, and exchanged</p>
                <div class="arrow">Read the protocol →</div>
            </a>

            <a href="/integration" class="protocol-link">
                <div class="label">SDK</div>
                <h3>Integration (SDK)</h3>
                <p>Tools for building AI that obeys the protocol</p>
                <div class="arrow">Explore the SDK →</div>
            </a>

            <a href="/service" class="protocol-link">
                <div class="label">Implementation</div>
                <h3>Service Providers</h3>
                <p>Infrastructure enforcing compliance at scale</p>
                <div class="arrow">View architecture →</div>
            </a>

            <a href="/governance" class="protocol-link">
                <div class="label">Governance</div>
                <h3>Governance</h3>
                <p>Verifiable, federated oversight without centralization</p>
                <div class="arrow">Read framework →</div>
            </a>
        </div>
    </section>

</BaseLayout>

<style>
    /* Hero Section */
    .hero {
        max-width: 1200px;
        margin: 0 auto;
        padding: 12rem 1.5rem 6rem;
        min-height: 80vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .hero h1 {
        font-size: clamp(2.5rem, 6vw, 4.5rem);
        font-weight: 700;
        line-height: 1.1;
        letter-spacing: -0.03em;
        max-width: 900px;
        margin-bottom: 1.5rem;
    }

    .hero .highlight {
        color: var(--accent);
    }

    .hero-subtitle {
        font-size: clamp(1.1rem, 2vw, 1.4rem);
        color: var(--text-secondary);
        max-width: 800px;
        margin-bottom: 3rem;
        line-height: 1.6;
    }

    .hero .version-wrapper {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.85rem;
        margin-bottom: 1rem;
    }

    .hero .version {
        display: inline-block;
        color: var(--text-tertiary);
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        padding: 0.35rem 0.85rem;
        border-radius: 2rem;
        font-weight: 500;
    }

    .hero .version-date {
        color: var(--text-tertiary);
        font-weight: 400;
    }

    .cta-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    /* Why This Matters */
    .why-matters {
        max-width: 1200px;
        margin: 6rem auto;
        padding: 0 1.5rem;
    }

    .why-content {
        max-width: 800px;
    }

    .why-content p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .danger-statement {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 2rem;
        margin-bottom: 1rem;
    }

    .danger-list {
        list-style: none;
        padding-left: 1.5rem;
        margin-bottom: 2rem;
    }

    .danger-list li {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
    }

    .danger-list li::before {
        content: "→ ";
        color: var(--accent);
        font-weight: bold;
        margin-right: 0.5rem;
    }

    .danger-inline {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 2rem;
        color: var(--text-secondary);
        font-style: italic;
    }

    .key-insight {
        font-size: clamp(1.15rem, 2.2vw, 1.35rem);
        font-weight: 600;
        color: var(--text-primary);
        margin: 2rem 0;
    }

    .stage-list {
        list-style: none;
        padding-left: 0;
        margin: 1.5rem 0 2rem;
    }

    .stage-list li {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
        padding-left: 1.5rem;
    }

    .stage-list li::before {
        content: "• ";
        color: var(--accent);
        font-weight: bold;
        margin-left: -1.5rem;
        margin-right: 0.5rem;
    }

    .v03-highlight {
        background: var(--accent-subtle);
        padding: 1.5rem;
        border-left: 3px solid var(--accent);
        margin: 2rem 0;
        border-radius: 0.5rem;
    }

    .why-content .emphasis {
        font-size: clamp(1.3rem, 2.5vw, 1.6rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 3rem;
    }

    /* How It Works */
    .how-it-works {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .mechanism-title {
        font-size: clamp(1.5rem, 3vw, 2rem);
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 3rem;
        text-align: center;
    }

    .steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .step {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem 2rem;
        text-align: center;
    }

    .step-number {
        width: 3rem;
        height: 3rem;
        background: var(--accent);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 auto 1.5rem;
    }

    .step h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .step p {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 0;
    }

    .enforcement-statement {
        font-size: clamp(1.2rem, 2vw, 1.4rem);
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 2rem;
        text-align: center;
        line-height: 1.6;
    }

    /* Two Inquiry Modes */
    .inquiry-modes {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .modes-intro {
        font-size: clamp(1.1rem, 2vw, 1.3rem);
        color: var(--text-primary);
        margin-bottom: 3rem;
        max-width: 800px;
    }

    .modes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .mode-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .mode-card h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--accent);
    }

    .mode-purpose {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
        font-style: italic;
    }

    .mode-card ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .mode-card li {
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
        color: var(--text-primary);
        line-height: 1.6;
    }

    .mode-card li:last-child {
        border-bottom: none;
    }

    .modes-rule {
        font-size: clamp(1.1rem, 2vw, 1.3rem);
        color: var(--text-primary);
        margin-top: 3rem;
        max-width: 800px;
        line-height: 1.7;
    }

    /* The Inquiry Ladder */
    .inquiry-ladder {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .ladder-intro {
        font-size: clamp(1.1rem, 2vw, 1.3rem);
        color: var(--text-primary);
        margin-bottom: 3rem;
        max-width: 800px;
    }

    .ladder-steps {
        display: grid;
        gap: 1.5rem;
        margin-bottom: 3rem;
        max-width: 700px;
    }

    .ladder-step {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2rem;
        display: flex;
        align-items: center;
        gap: 2rem;
    }

    .ladder-number {
        width: 3rem;
        height: 3rem;
        background: var(--accent);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .ladder-content h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .ladder-content p {
        color: var(--text-secondary);
        margin: 0;
        line-height: 1.6;
    }

    .ladder-explanation {
        max-width: 800px;
    }

    .ladder-explanation p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .ladder-result {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 2rem;
    }

    /* Core Principles */
    .principles {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .principles-list {
        max-width: 900px;
        display: grid;
        gap: 2.5rem;
    }

    .principle-item {
        border-left: 3px solid var(--accent);
        padding-left: 2rem;
    }

    .principle-item h3 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
    }

    .principle-item p {
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: clamp(1rem, 2vw, 1.1rem);
    }

    /* Why This Matters Right Now */
    .matters-now {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .matters-content {
        max-width: 800px;
    }

    .matters-content p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .matters-lead {
        font-size: clamp(1.3rem, 2.5vw, 1.6rem);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2rem;
    }

    .ensures-list {
        list-style: none;
        padding-left: 0;
        margin: 1.5rem 0 2rem;
    }

    .ensures-list li {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
        padding-left: 1.5rem;
    }

    .ensures-list li::before {
        content: "✓ ";
        color: var(--accent);
        font-weight: bold;
        margin-left: -1.5rem;
        margin-right: 0.5rem;
    }

    .matters-conclusion {
        font-size: clamp(1.3rem, 2.5vw, 1.6rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 3rem;
    }

    /* Shared Styles */
    .section-title {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.02em;
        margin-bottom: 4rem;
        max-width: 600px;
    }

    /* Documentation */
    .protocol-nav {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .protocol-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top: 3rem;
    }

    .protocol-link {
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        padding: 2rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s;
        display: block;
    }

    .protocol-link:hover {
        border-color: var(--accent);
        background: var(--accent-subtle);
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
    }

    @media (prefers-color-scheme: dark) {
        .protocol-link:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
    }

    .protocol-link .label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-tertiary);
        margin-bottom: 0.5rem;
    }

    .protocol-link h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .protocol-link p {
        color: var(--text-secondary);
        line-height: 1.7;
    }

    .protocol-link .arrow {
        margin-top: 1rem;
        color: var(--accent);
        font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero {
            padding-top: 8rem;
            min-height: auto;
        }

        .cta-group {
            flex-direction: column;
        }

        .btn {
            text-align: center;
        }

        .why-matters,
        .how-it-works,
        .inquiry-modes,
        .inquiry-ladder,
        .principles,
        .matters-now {
            margin: 4rem auto;
        }

        .steps {
            grid-template-columns: 1fr;
        }

        .modes-grid {
            grid-template-columns: 1fr;
        }

        .ladder-step {
            flex-direction: column;
            text-align: center;
        }
    }
</style>

<script>
    document.getElementById('copy-context')?.addEventListener('click', async () => {
        const button = document.getElementById('copy-context');
        const originalText = button?.textContent;

        try {
            button.textContent = 'Copying...';

            // Fetch the context page
            const response = await fetch('/context.txt');
            const text = await response.text();

            let copySucceeded = false;

            // Try modern clipboard API first (works on HTTPS and modern browsers)
            if (navigator.clipboard && navigator.clipboard.writeText) {
                try {
                    await navigator.clipboard.writeText(text);
                    copySucceeded = true;
                } catch (clipboardErr) {
                    console.log('Clipboard API failed, trying fallback:', clipboardErr);
                }
            }

            // Fallback for iOS Safari and older browsers
            if (!copySucceeded) {
                const textarea = document.createElement('textarea');
                textarea.value = text;

                // Make textarea visible for iOS
                textarea.style.position = 'absolute';
                textarea.style.left = '-9999px';
                textarea.style.top = '0';
                textarea.setAttribute('readonly', '');

                document.body.appendChild(textarea);

                // iOS-specific selection
                if (navigator.userAgent.match(/ipad|iphone/i)) {
                    const range = document.createRange();
                    range.selectNodeContents(textarea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textarea.setSelectionRange(0, textarea.value.length);
                } else {
                    textarea.select();
                }

                try {
                    copySucceeded = document.execCommand('copy');
                } catch (e) {
                    console.error('execCommand failed:', e);
                }

                document.body.removeChild(textarea);
            }

            if (copySucceeded) {
                // Success feedback
                button.textContent = 'Copied! Paste it in your AI Chat';
                setTimeout(() => {
                    if (button) button.textContent = originalText;
                }, 3000);
            } else {
                throw new Error('All copy methods failed');
            }
        } catch (err) {
            console.error('Failed to copy:', err);
            button.textContent = 'Copy failed - try manually';
            setTimeout(() => {
                if (button) button.textContent = originalText;
            }, 3000);
        }
    });
</script>
