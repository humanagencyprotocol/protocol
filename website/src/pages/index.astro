---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="HAP - The Human Direction Protocol">
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
        <h1>When AI Can Do Everything, <span class="highlight">The Only Value Left Is Deciding What Matters.</span></h1>
        <h2 class="hero-subtitle">HAP Makes Sure Humans Still Do That.</h2>

        <div class="hero-body">
            <p>AI makes execution effortless — producing, optimizing, and handling tasks faster than humans ever could.</p>
            <p>But AI cannot define direction.<br>It cannot decide what matters, what the work is for, or which path is worth pursuing.</p>
            <p class="key-statement"><strong><span class="highlight">Direction is the last human domain.<br>HAP protects it.</span></strong></p>
        </div>

        <div class="cta-group">
            <button id="ask-ai-btn" class="btn btn-primary">Ask your AI about this protocol</button>
            <a href="#why-exists" class="btn btn-secondary">Why HAP Exists</a>
        </div>

        <!-- Persona Selection -->
        <div id="persona-section" class="persona-section" style="display: none;">
            <p class="persona-intro">Create a prompt to describe HAP for</p>
            <div class="persona-grid">
                <button class="persona-btn" data-persona="beginner">
                    <span class="persona-title">A Five Year Old</span>
                </button>
                <button class="persona-btn" data-persona="entrepreneur">
                    <span class="persona-title">An Entrepreneur</span>
                </button>
                <button class="persona-btn" data-persona="architect">
                    <span class="persona-title">A Protocol Integrator</span>
                </button>
                <button class="persona-btn" data-persona="strategist">
                    <span class="persona-title">A Business Strategist</span>
                </button>
                <button class="persona-btn" data-persona="investor">
                    <span class="persona-title">An Investor</span>
                </button>
                <button class="persona-btn" data-persona="custom">
                    <span class="persona-title">You</span>
                </button>
            </div>

            <!-- Expanded Prompt Display -->
            <div id="prompt-display" class="prompt-display" style="display: none;">
                <div class="prompt-content">
                    <h4 id="prompt-title" class="prompt-title"></h4>
                    <p id="prompt-text" class="prompt-text"></p>
                    <textarea id="custom-prompt-input" class="custom-prompt-input" style="display: none;" placeholder="Describe who you are and what you want to learn about HAP..."></textarea>
                    <button id="copy-prompt-btn" class="btn btn-primary">Copy the prompt</button>
                </div>
            </div>
        </div>
        </div>
    </section>

    <!-- Why HAP Exists -->
    <section id="why-exists" class="content-section">
        <h2 class="section-title">Why HAP Exists</h2>
        <div class="section-body">
            <p>Modern AI systems don't wait.<br>They act, escalate, optimize, and predict.</p>
            <p>HAP forces AI to pause whenever a human decision is required.<br>No assumptions. No silent automation.<br>The system cannot move forward until a human sets direction.</p>
            <p>If humans stop defining direction, AI will step into the vacuum — not maliciously, but because it moves faster than we do.</p>
            <p class="key-statement">And when AI sets the direction, <strong>it optimizes for its metrics, not human needs.</strong></p>
            <p>HAP prevents that by enforcing human direction at the moments automation cannot replace.</p>
        </div>
    </section>

    <!-- Why Direction Has a Cost -->
    <section class="content-section">
        <h2 class="section-title">Why Direction Has a Cost — And Why It Matters</h2>
        <div class="section-body">
            <p>AI can execute any path, but only humans can choose which path should exist.<br>That choice has a cost: choosing one direction means abandoning others.</p>
            <p>A direction has meaning only when a human is willing to carry the responsibility and consequences that come with it.<br>AI has no stakes — therefore it cannot choose.</p>
            <p>If a decision can be reversed or ignored without consequence, it isn't direction. It's preference.</p>
            <p class="key-statement"><strong>HAP ensures direction is human-defined, human-owned, and costly enough to matter — no back door, no avoidance.</strong></p>
        </div>
    </section>

    <!-- What AI Can Do vs. What Humans Must Do -->
    <section class="comparison-section">
        <h2 class="section-title">What AI Can Do vs. What Humans Must Do</h2>

        <div class="comparison-grid">
            <div class="comparison-card">
                <h3>AI can:</h3>
                <ul>
                    <li>generate options</li>
                    <li>simulate outcomes</li>
                    <li>execute tasks</li>
                    <li>correct mistakes</li>
                    <li>plan optimally</li>
                    <li>scale instantly</li>
                </ul>
            </div>

            <div class="comparison-card highlight">
                <h3>AI cannot:</h3>
                <ul>
                    <li>define what matters</li>
                    <li>choose which priority wins</li>
                    <li>decide what is worth the cost</li>
                    <li>commit an identity</li>
                    <li>take responsibility</li>
                </ul>
            </div>
        </div>

        <p class="section-conclusion">
            <strong>Direction is human.<br>
            Execution is machine.<br>
            HAP keeps the boundary intact.</strong>
        </p>
    </section>

    <!-- The HAP Checkpoints -->
    <section class="checkpoints-section">
        <h2 class="section-title">The HAP Checkpoints</h2>
        <p class="section-intro">HAP integrates into any AI system and forces it to pause whenever a real human decision is required.</p>
        <p class="section-intro emphasis">AI cannot continue until the human sets direction.</p>

        <div class="checkpoints">
            <div class="checkpoint">
                <div class="checkpoint-number">1</div>
                <div class="checkpoint-content">
                    <h4>Meaning — What are we talking about?</h4>
                    <p>Humans set the frame. Machines cannot.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-number">2</div>
                <div class="checkpoint-content">
                    <h4>Purpose — Why does this matter now?</h4>
                    <p>Prioritization is a trade-off. Only humans can make it.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-number">3</div>
                <div class="checkpoint-content">
                    <h4>Commitment — What will we commit to?</h4>
                    <p>Options are cheap. Commitment costs — and only humans can pay it.</p>
                </div>
            </div>

            <div class="checkpoint">
                <div class="checkpoint-number">4</div>
                <div class="checkpoint-content">
                    <h4>Action — Who owns the outcome?</h4>
                    <p>Machines execute. Humans take responsibility.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How HAP Works -->
    <section class="how-it-works">
        <h2 class="section-title">How HAP Works</h2>
        <h3 class="mechanism-title">Stop → Ask → Confirm → Proceed</h3>

        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <h4>Stop</h4>
                <p>AI detects unclear meaning, purpose, intention, or responsibility.</p>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <h4>Ask</h4>
                <p>HAP triggers a structured question that forces human direction.</p>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <h4>Confirm</h4>
                <p>The human confirms the decision the AI must follow.</p>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <h4>Proceed</h4>
                <p>Only then does the system continue.</p>
            </div>
        </div>

        <p class="enforcement-statement">
            <strong>No skipping.<br>
            No inference.<br>
            No silent automation.</strong>
        </p>
    </section>

    <!-- Why This Matters Now -->
    <section class="matters-now">
        <h2 class="section-title">Why This Matters Now</h2>
        <div class="matters-content">
            <p>As AI accelerates, execution becomes free.<br>Abundance becomes default.</p>
            <p class="key-insight">The real scarcity becomes <strong>human direction</strong> — decisions that cost something, commit someone, and shape a trajectory.</p>
            <p class="emphasis">This is the last human value.</p>
            <p>If humans stop making the hard calls, machines will make them by default.<br>And once AI defines direction, human agency dissolves — quietly, through convenience.</p>
            <p class="conclusion">HAP is the boundary that preserves human authorship in an automated world.</p>
        </div>
    </section>

    <!-- What HAP Enables -->
    <section class="enables-section">
        <h2 class="section-title">What HAP Enables</h2>

        <div class="enables-grid">
            <div class="enable-card">
                <h3>Individuals</h3>
                <p>You stop drifting through AI-generated options and start defining what matters.</p>
            </div>

            <div class="enable-card">
                <h3>Teams</h3>
                <p>Alignment becomes real — because decisions require shared commitment.</p>
            </div>

            <div class="enable-card">
                <h3>Organizations</h3>
                <p>Strategy becomes human-led again.<br>Accountability returns.</p>
            </div>

            <div class="enable-card highlight">
                <h3>Society</h3>
                <p>We preserve the one thing automation cannot replace:<br><strong>the human ability to choose a direction worth living for.</strong></p>
            </div>
        </div>
    </section>

    <!-- Build With HAP -->
    <section class="protocol-nav" id="protocol">
        <h2 class="section-title">Build With HAP</h2>

        <div class="protocol-links">
            <a href="/protocol" class="protocol-link">
                <div class="label">Protocol</div>
                <h3>Protocol</h3>
                <p>How direction is described, measured, and enforced</p>
                <div class="arrow">Read the protocol →</div>
            </a>

            <a href="/integration" class="protocol-link">
                <div class="label">SDK</div>
                <h3>SDK</h3>
                <p>Tools for integrating direction checkpoints</p>
                <div class="arrow">Explore the SDK →</div>
            </a>

            <a href="/service" class="protocol-link">
                <div class="label">Service Providers</div>
                <h3>Service Providers</h3>
                <p>Verified infrastructure enforcing compliance</p>
                <div class="arrow">View architecture →</div>
            </a>

            <a href="/governance" class="protocol-link">
                <div class="label">Governance</div>
                <h3>Governance</h3>
                <p>Transparent, federated oversight</p>
                <div class="arrow">Read framework →</div>
            </a>
        </div>

        <p class="section-conclusion" style="margin-top: 3rem; text-align: center;">
            <strong>HAP turns human direction into the governing layer of intelligent systems.</strong>
        </p>
    </section>

</BaseLayout>

<style>
    /* Hero Section */
    .hero {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 0 1.5rem;
    }

    .hero-content {
        max-width: 1200px;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .hero h1 {
        font-size: clamp(2.5rem, 6vw, 4.5rem);
        font-weight: 700;
        line-height: 1.1;
        letter-spacing: -0.03em;
        max-width: 980px;
        margin-bottom: 2.5rem;
    }

    @media (min-width: 769px) {
        .hero h1 {
            padding: 0 1.5rem;
        }
    }

    .hero .highlight {
        color: var(--accent);
    }

    .hero-subtitle {
        font-size: clamp(1.3rem, 2.5vw, 1.8rem);
        font-weight: 600;
        color: var(--text-primary);
        max-width: 800px;
        margin-bottom: 2rem;
        line-height: 1.3;
    }

    @media (min-width: 769px) {
        .hero-subtitle {
            padding: 0 1.5rem;
        }
    }

    .hero-tagline {
        font-size: clamp(1.1rem, 2vw, 1.4rem);
        font-weight: 600;
        color: var(--accent);
        max-width: 900px;
        margin-bottom: 2rem;
        line-height: 1.4;
    }

    @media (min-width: 769px) {
        .hero-tagline {
            padding: 0 1.5rem;
        }
    }

    .hero-body {
        max-width: 800px;
        margin-bottom: 3rem;
    }

    @media (min-width: 769px) {
        .hero-body {
            padding: 0 1.5rem;
        }
    }

    .hero-body p {
        font-size: clamp(1rem, 1.8vw, 1.2rem);
        line-height: 1.7;
        margin-bottom: 1.2rem;
        color: var(--text-primary);
    }

    .key-statement {
        font-size: clamp(1.1rem, 2vw, 1.35rem);
        font-weight: 600;
        color: var(--text-primary);
        margin: 1.5rem 0;
    }

    .emphasis {
        font-weight: 600;
        color: var(--accent);
    }

    .cta-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    @media (min-width: 769px) {
        .cta-group {
            padding: 0 1.5rem;
        }
    }

    .btn.clicked {
        opacity: 0.7;
    }

    /* Persona Section */
    .persona-section {
        max-width: 800px;
        margin-top: 2rem;
        animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .persona-intro {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        font-weight: 500;
    }

    .persona-grid {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }

    .persona-grid::-webkit-scrollbar {
        display: none;
    }

    @media (min-width: 900px) {
        .persona-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            overflow-x: visible;
        }
    }

    .persona-btn {
        background: var(--accent);
        border: 2px solid var(--accent);
        border-radius: 0.75rem;
        padding: 1rem 0.85rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
        min-width: 180px;
        flex-shrink: 0;
        scroll-snap-align: start;
        justify-content: center;
        align-items: center;
    }

    @media (min-width: 900px) {
        .persona-btn {
            min-width: auto;
            padding: 1.5rem 1.25rem;
        }
    }

    .persona-btn:hover {
        background: #C88A2E;
        border-color: #C88A2E;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(223, 163, 70, 0.25);
    }

    .persona-btn.active {
        background: #C88A2E;
        border-color: #C88A2E;
        box-shadow: 0 8px 20px rgba(223, 163, 70, 0.25);
    }

    .persona-title {
        font-size: 1rem;
        font-weight: 600;
        color: white;
        display: block;
    }

    .prompt-display {
        background: var(--bg-elevated);
        border: 2px solid var(--accent);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-top: 1rem;
        animation: slideDown 0.3s ease-out;
    }

    .prompt-content {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .prompt-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--accent);
        margin: 0;
    }

    .prompt-text {
        font-size: 0.95rem;
        line-height: 1.7;
        color: var(--text-primary);
        margin: 0;
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        border-left: 3px solid var(--accent);
    }

    .custom-prompt-input {
        font-size: 0.95rem;
        line-height: 1.7;
        color: var(--text-primary);
        margin: 0;
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        border: 2px solid var(--border);
        border-left: 3px solid var(--accent);
        font-family: inherit;
        resize: vertical;
        min-height: 120px;
        width: 100%;
        box-sizing: border-box;
    }

    .custom-prompt-input:focus {
        outline: none;
        border-color: var(--accent);
    }

    /* Content Sections */
    .content-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .section-body {
        max-width: 800px;
    }

    .section-body p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    /* Comparison Section */
    .comparison-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
    }

    .comparison-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .comparison-card.highlight {
        border-color: var(--accent);
        background: var(--accent-subtle);
    }

    .comparison-card h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .comparison-card ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .comparison-card li {
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
        color: var(--text-primary);
        line-height: 1.6;
        font-size: clamp(1rem, 1.8vw, 1.1rem);
    }

    .comparison-card li:last-child {
        border-bottom: none;
    }

    .section-conclusion {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 3rem;
        max-width: 800px;
        line-height: 1.6;
    }

    /* Checkpoints Section */
    .checkpoints-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .section-intro {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        color: var(--text-primary);
        margin-bottom: 1rem;
        max-width: 800px;
        line-height: 1.7;
    }

    .checkpoints {
        display: grid;
        gap: 1.5rem;
        margin-top: 3rem;
        max-width: 900px;
    }

    .checkpoint {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2rem;
        display: flex;
        align-items: flex-start;
        gap: 2rem;
    }

    .checkpoint-number {
        width: 3rem;
        height: 3rem;
        background: var(--accent);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .checkpoint-content h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
    }

    .checkpoint-content p {
        color: var(--text-secondary);
        margin: 0;
        line-height: 1.6;
    }

    /* How It Works */
    .how-it-works {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .mechanism-title {
        font-size: clamp(1.5rem, 3vw, 2rem);
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 3rem;
        text-align: center;
    }

    .steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .step {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem 2rem;
        text-align: center;
    }

    .step-number {
        width: 3rem;
        height: 3rem;
        background: var(--accent);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 auto 1.5rem;
    }

    .step h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .step p {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 0;
    }

    .enforcement-statement {
        font-size: clamp(1.2rem, 2vw, 1.4rem);
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 2rem;
        text-align: center;
        line-height: 1.8;
    }

    /* Why This Matters Now */
    .matters-now {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .matters-content {
        max-width: 800px;
    }

    .matters-content p {
        font-size: clamp(1.05rem, 2vw, 1.2rem);
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }

    .key-insight {
        font-size: clamp(1.15rem, 2.2vw, 1.35rem);
        font-weight: 600;
        color: var(--text-primary);
        margin: 2rem 0;
    }

    .matters-content .emphasis {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        display: block;
        margin: 2rem 0;
    }

    .conclusion {
        font-size: clamp(1.2rem, 2.2vw, 1.4rem);
        font-weight: 600;
        color: var(--accent);
        margin-top: 2rem;
    }

    /* What HAP Enables */
    .enables-section {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .enables-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }

    .enable-card {
        background: var(--bg-elevated);
        border: 2px solid var(--border);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .enable-card.highlight {
        border-color: var(--accent);
        background: var(--accent-subtle);
    }

    .enable-card h3 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--accent);
    }

    .enable-card p {
        color: var(--text-primary);
        line-height: 1.7;
        font-size: clamp(1rem, 1.8vw, 1.1rem);
        margin: 0;
    }

    /* Shared Styles */
    .section-title {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.02em;
        margin-bottom: 2rem;
        max-width: 800px;
    }

    /* Documentation */
    .protocol-nav {
        max-width: 1200px;
        margin: 8rem auto;
        padding: 0 1.5rem;
    }

    .protocol-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top: 3rem;
    }

    .protocol-link {
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        padding: 2rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s;
        display: block;
    }

    .protocol-link:hover {
        border-color: var(--accent);
        background: var(--accent-subtle);
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
    }

    @media (prefers-color-scheme: dark) {
        .protocol-link:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
    }

    .protocol-link .label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-tertiary);
        margin-bottom: 0.5rem;
    }

    .protocol-link h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .protocol-link p {
        color: var(--text-secondary);
        line-height: 1.7;
    }

    .protocol-link .arrow {
        margin-top: 1rem;
        color: var(--accent);
        font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero {
            padding-top: 8rem;
            min-height: auto;
        }

        .cta-group {
            flex-direction: column;
        }

        .btn {
            text-align: center;
        }

        .content-section,
        .comparison-section,
        .checkpoints-section,
        .how-it-works,
        .matters-now,
        .enables-section {
            margin: 4rem auto;
        }

        .steps {
            grid-template-columns: 1fr;
        }

        .comparison-grid {
            grid-template-columns: 1fr;
        }

        .checkpoint {
            flex-direction: column;
            text-align: center;
        }
    }
</style>

<script>
    // Persona prompts
    const personas = {
        beginner: {
            title: 'Explain Like I\'m Five',
            prompt: 'You are explaining this protocol to someone who only knows ChatGPT and has no technical background. Use simple language, everyday analogies, and concrete examples. Explain what problem this solves, why it matters, and how it would affect their daily AI interactions. Avoid jargon and technical terms.'
        },
        entrepreneur: {
            title: 'Entrepreneur',
            prompt: 'You are an entrepreneur exploring new market opportunities with HAP. I\'m looking for business ideas and applications that can be built using this protocol. Analyze potential products, services, and business models that leverage HAP. Focus on market gaps, customer needs, competitive advantages, and practical implementation paths for new ventures. Help me understand how HAP can be a foundation for building innovative solutions.'
        },
        architect: {
            title: 'Protocol Integrator',
            prompt: 'You are a protocol integrator evaluating how to implement this protocol into our existing system. Assess integration feasibility, technical requirements, implementation complexity, and compatibility with our current infrastructure. Provide a detailed technical assessment covering APIs, data flows, security considerations, and deployment strategies for our specific context.'
        },
        strategist: {
            title: 'Business Strategist',
            prompt: 'You are a business strategist analyzing how this protocol would impact my business. Evaluate adoption benefits, competitive advantages, operational changes, and strategic implications for my specific business. Focus on how it affects my operations, customer relationships, and value delivery. Provide actionable insights tailored to my business context.'
        },
        investor: {
            title: 'Investor',
            prompt: 'You are an investor evaluating this protocol as a commercial opportunity. Focus on monetization potential, particularly around HAP Service Providers and consulting services. Analyze market size, revenue models, competitive advantages, implementation costs, and ROI projections. Identify the most promising business opportunities and potential risks.'
        },
        custom: {
            title: 'You - Create your own prompt',
            prompt: '' // User will input their own prompt
        }
    };

    let currentPersona = null;
    let contextText = null;

    // Copy function (reusable)
    async function copyToClipboard(text, button, successMsg, originalText) {
        let copySucceeded = false;

        // Try modern clipboard API first
        if (navigator.clipboard && navigator.clipboard.writeText) {
            try {
                await navigator.clipboard.writeText(text);
                copySucceeded = true;
            } catch (clipboardErr) {
                console.log('Clipboard API failed, trying fallback:', clipboardErr);
            }
        }

        // Fallback for iOS Safari and older browsers
        if (!copySucceeded) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            textarea.style.top = '0';
            textarea.setAttribute('readonly', '');
            document.body.appendChild(textarea);

            if (navigator.userAgent.match(/ipad|iphone/i)) {
                const range = document.createRange();
                range.selectNodeContents(textarea);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                textarea.setSelectionRange(0, textarea.value.length);
            } else {
                textarea.select();
            }

            try {
                copySucceeded = document.execCommand('copy');
            } catch (e) {
                console.error('execCommand failed:', e);
            }

            document.body.removeChild(textarea);
        }

        if (copySucceeded) {
            button.textContent = successMsg;
            setTimeout(() => {
                if (button) button.textContent = originalText;
            }, 3000);
        } else {
            throw new Error('All copy methods failed');
        }
    }

    // Fetch context text
    async function fetchContext() {
        if (!contextText) {
            const response = await fetch('/context.txt');
            contextText = await response.text();
        }
        return contextText;
    }

    // Toggle persona section
    document.getElementById('ask-ai-btn')?.addEventListener('click', async () => {
        const button = document.getElementById('ask-ai-btn');
        const personaSection = document.getElementById('persona-section');
        const promptDisplay = document.getElementById('prompt-display');

        if (personaSection.style.display === 'none' || !personaSection.style.display) {
            // Open persona section
            button.classList.add('clicked');
            personaSection.style.display = 'block';

            // Scroll button to top of viewport with offset for header
            // Use setTimeout to wait for DOM update
            setTimeout(() => {
                const buttonTop = button.getBoundingClientRect().top + window.scrollY;
                const headerOffset = 120; // Account for fixed header height (taller on desktop)
                window.scrollTo({
                    top: buttonTop - headerOffset,
                    behavior: 'smooth'
                });
            }, 100);

            // Prefetch context
            try {
                await fetchContext();
            } catch (err) {
                console.error('Failed to fetch context:', err);
            }
        } else {
            // Close persona section
            button.classList.remove('clicked');
            personaSection.style.display = 'none';
            promptDisplay.style.display = 'none';

            // Reset active states
            document.querySelectorAll('.persona-btn').forEach(b => b.classList.remove('active'));
            currentPersona = null;
        }
    });

    // Handle persona selection
    document.querySelectorAll('.persona-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const persona = btn.dataset.persona;
            currentPersona = persona;

            // Update active state
            document.querySelectorAll('.persona-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Show prompt display
            const promptDisplay = document.getElementById('prompt-display');
            const promptTitle = document.getElementById('prompt-title');
            const promptText = document.getElementById('prompt-text');
            const customInput = document.getElementById('custom-prompt-input');

            promptTitle.textContent = personas[persona].title;

            // Handle custom persona differently
            if (persona === 'custom') {
                promptText.style.display = 'none';
                customInput.style.display = 'block';
                customInput.value = ''; // Clear previous input
            } else {
                promptText.style.display = 'block';
                customInput.style.display = 'none';
                promptText.textContent = personas[persona].prompt;
            }

            promptDisplay.style.display = 'block';

            // Scroll to prompt display
            promptDisplay.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });
    });

    // Copy prompt with context
    document.getElementById('copy-prompt-btn')?.addEventListener('click', async () => {
        const button = document.getElementById('copy-prompt-btn');
        const originalText = button.textContent;

        try {
            button.textContent = 'Copying...';

            const context = await fetchContext();

            // Get prompt based on persona type
            let personaPrompt;
            if (currentPersona === 'custom') {
                const customInput = document.getElementById('custom-prompt-input');
                personaPrompt = customInput.value.trim();
            } else {
                personaPrompt = personas[currentPersona].prompt;
            }

            // Combine prompt and context (only add separator if there's a prompt)
            const combinedText = personaPrompt
                ? `${personaPrompt}\n\n---\n\n${context}`
                : context;

            await copyToClipboard(
                combinedText,
                button,
                'Copied! Paste it in your AI Chat',
                originalText
            );
        } catch (err) {
            console.error('Failed to copy:', err);
            button.textContent = 'Copy failed - try manually';
            setTimeout(() => {
                if (button) button.textContent = originalText;
            }, 3000);
        }
    });
</script>
